#include <iostream>
#include <vector>
#include <unordered_map>
#include <unordered_set>

void findComponent(int vertex, int prev, const std::vector<std::vector<int>>& graph,
                   std::vector<int>& components, int current_component) {
    components[vertex] = current_component;
    for (const auto& neighbour : graph[vertex]) {
        if (neighbour == prev || components[neighbour] != -1) {
            continue;
        }
        findComponent(neighbour, vertex, graph, components, current_component);
    }
}

class Solution {
public:
    int minMalwareSpread(std::vector<std::vector<int>>& grid, std::vector<int>& initial) {
        int n = grid.size();
        std::vector<std::vector<int>> graph(n);
        for (int i = 0; i < n; i++) {
            for (int j = 0; j < n; j++) {
                if (grid[i][j] && i != j) {
                    graph[i].push_back(j);
                    graph[j].push_back(i);
                }
            }
        }
        std::vector<int> components(n, -1);
        int current_component = 1;
        for (int i = 0; i < n; i++) {
            if (components[i] == -1) {
                findComponent(i, -1, graph, components, current_component++);
            }
        }
        std::vector<int> component_size(current_component, 0);
        for (const auto& component : components) {
            component_size[component]++;
        }
        std::vector<int> malware_in_component(current_component);
        for (const auto& node : initial) {
            malware_in_component[components[node]]++;
        }
        int mini = 0;
        std::sort(initial.begin(), initial.end());
        int result_node = initial[0];
        for (const auto& node : initial) {
            if (malware_in_component[components[node]] == 1) {
                int current = component_size[components[node]];
                if (current > mini || (current == mini && node < result_node)) {
                    mini = current;
                    result_node = node;
                }
            }
        }
        return result_node;
    }
};